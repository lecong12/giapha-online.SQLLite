<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gia Ph·∫£ Online - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style/style.css">
    <style>
@keyframes slideInRight {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

/* ‚úÖ C·ªë ƒë·ªãnh Header */
.header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 65px;
    z-index: 1000;
    background-color: #ffffff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* ‚úÖ C·ªë ƒë·ªãnh thanh menu (tabs) ngay d∆∞·ªõi Header */
.tabs-container {
    position: fixed;
    top: 65px;
    left: 0;
    width: 100%;
    z-index: 999;
    background-color: #ffffff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 0 20px;
    height: 50px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
}

.tabs-left {
    display: flex;
    height: 100%;
    gap: 5px;
}

.tab-btn {
    background: none;
    border: none;
    padding: 0 15px;
    height: 100%;
    cursor: pointer;
    font-weight: 500;
    color: #6b7280;
    border-bottom: 3px solid transparent;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    transition: all 0.2s;
}

.tab-btn:hover {
    color: #0ea5e9;
    background-color: #f0f9ff;
}

.tab-btn.active {
    color: #0ea5e9;
    border-bottom-color: #0ea5e9;
}

.tabs-right {
    display: flex;
    align-items: center;
}

.control-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Style cho √¥ t√¨m ki·∫øm nh·ªè g·ªçn tr√™n menu */
.search-compact {
    position: relative;
}
.search-compact input {
    padding: 6px 10px 6px 32px;
    border: 1px solid #e5e7eb;
    border-radius: 20px;
    font-size: 13px;
    width: 220px;
    outline: none;
    transition: border-color 0.2s;
    background: #f9fafb;
}
.search-compact input:focus {
    border-color: #0ea5e9;
    background: #fff;
    width: 260px; /* Hi·ªáu ·ª©ng m·ªü r·ªông khi focus */
}
.search-compact i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 12px;
}

/* N√∫t nh·ªè g·ªçn tr√™n menu */
.btn-menu {
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 13px;
    cursor: pointer;
    border: none;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    transition: transform 0.1s;
}
.btn-menu:active {
    transform: scale(0.95);
}
.btn-primary-sm {
    background: linear-gradient(135deg, #0ea5e9, #38bdf8);
    color: white;
}
.btn-outline-sm {
    background: #fff;
    border: 1px solid #e5e7eb;
    color: #374151;
}
.btn-outline-sm:hover {
    background: #f3f4f6;
}

/* ‚úÖ ƒê·∫©y n·ªôi dung xu·ªëng ƒë·ªÉ kh√¥ng b·ªã che b·ªüi Header v√† Tabs c·ªë ƒë·ªãnh */
.main-content {
    margin-top: 135px; /* 65 (header) + 50 (tabs) + 20 (gap) */
}
</style>
</head>
<body class="dashboard-page">
    <!-- HEADER -->
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-sitemap"></i>
                </div>
                <div class="header-info">
                    <h1>Gia Ph·∫£ Online</h1>
                    <p class="user-role" id="userRole"></p>
                </div>
            </div>
            <div class="header-right">
                <span class="user-name" id="userName"></span>
                <button class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t
                </button>
            </div>
        </div>
    </header>

    <!-- TABS -->
    <div class="tabs-container">
        <div class="tabs-left">
            <button class="tab-btn active" data-tab="dashboard" data-target="#dashboard">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="tab-btn" data-tab="tree" data-target="#tree">
                <i class="fas fa-sitemap"></i> C√¢y Gia Ph·∫£
            </button>
            <button class="tab-btn" data-tab="members" data-target="#members">
                <i class="fas fa-users"></i> Th√†nh vi√™n
            </button>
            <button class="tab-btn" data-tab="posts" data-target="#posts">
                <i class="fas fa-newspaper"></i> B√†i Vi·∫øt
            </button>
            <button class="tab-btn" data-tab="settings" data-target="#settings">
                <i class="fas fa-cog"></i> C√†i ƒê·∫∑t
            </button>
        </div>

        <!-- KHU V·ª∞C C√îNG C·ª§ (S·∫Ω thay ƒë·ªïi t√πy theo Tab ƒëang ch·ªçn) -->
        <div class="tabs-right">
            <!-- C√¥ng c·ª• cho Tab Th√†nh Vi√™n -->
            <div id="membersControls" class="control-group" style="display: none;">
                <div class="search-compact">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="T√¨m th√†nh vi√™n...">
                </div>
                <button class="btn-menu btn-outline-sm" onclick="openAdvancedSearch()" title="T√¨m n√¢ng cao">
                    <i class="fas fa-filter"></i>
                </button>
                <button class="btn-menu btn-primary-sm" onclick="openAddMemberModal()">
                    <i class="fas fa-plus"></i> Th√™m
                </button>
            </div>

            <!-- C√¥ng c·ª• cho Tab B√†i Vi·∫øt -->
            <div id="postsControls" class="control-group" style="display: none;">
                <button class="btn-menu btn-primary-sm" onclick="openCreatePostModal()">
                    <i class="fas fa-pen"></i> Vi·∫øt b√†i
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f97316, #fbbf24);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>T·ªïng Th√†nh Vi√™n</h3>
                        <div class="stat-number" id="totalMembers">0</div>
                        <span class="stat-change positive">Ng∆∞·ªùi</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4, #0ea5e9);">
                        <i class="fas fa-male"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Nam</h3>
                        <div class="stat-number" id="maleCount">0</div>
                        <span class="stat-change positive" id="malePercent">none</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #ec4899, #f43f5e);">
                        <i class="fas fa-female"></i>
                    </div>
                    <div class="stat-info">
                        <h3>N·ªØ</h3>
                        <div class="stat-number" id="femaleCount">0</div>
                        <span class="stat-change positive" id="femalePercent">none</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Th·∫ø H·ªá</h3>
                        <div class="stat-number" id="generationCount">0</div>
                        <span class="stat-change positive">ƒê·ªùi</span>
                    </div>
                </div>
            </div>

            <!-- GENERATION CHART -->
            <div class="tree-section">
                <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px;">
                    <i class="fas fa-chart-bar" style="color: var(--primary);"></i> Ph√¢n B·ªë Th·∫ø H·ªá
                </h3>
                <div id="generationChart"></div>
            </div>

            <!-- BIRTHDAYS, DEATH ANNIVERSARIES & ACTIVITIES -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 30px;">
                <!-- Card sinh nh·∫≠t -->
                <div class="tree-section">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px;">
                        <i class="fas fa-birthday-cake" style="color: var(--primary);"></i> 
                        Sinh nh·∫≠t s·∫Øp t·ªõi (45 ng√†y tr·ªü l·∫°i)
                    </h3>
                    <div id="birthdayList" style="display: flex; flex-direction: column; gap: 12px; overflow-y: auto; max-height: 500px;"></div>
                </div>

                <!-- Card ng√†y gi·ªó -->
                <div class="tree-section">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px;">
                        <i class="fas fa-candle-holder" style="color: #6b7280;"></i> 
                        Ng√†y Gi·ªó s·∫Øp t·ªõi (45 ng√†y tr·ªü l·∫°i)
                    </h3>
                    <div id="deathAnniversaryList" style="display: flex; flex-direction: column; gap: 12px; overflow-y: auto; max-height: 500px;"></div>
                </div>

                <!-- Card ho·∫°t ƒë·ªông -->
                <div class="tree-section">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px;">
                        <i class="fas fa-history" style="color: var(--primary);"></i> 
                        Ho·∫°t ƒê·ªông G·∫ßn ƒê√¢y
                    </h3>
                    <div id="activityList" style="display: flex; flex-direction: column; gap: 12px; overflow-y: auto; max-height: 500px;"></div>
                </div>
            </div>
        </div>
        <!-- K·∫æT TH√öC DASHBOARD TAB -->

<!-- FAMILY TREE TAB -->
<div id="tree" class="tab-content">
    <div class="tree-section">
        <div class="tree-controls">
            <!-- Dropdown ch·ªçn ng∆∞·ªùi -->
            <select id="personSelect" class="btn-control" style="min-width: 300px; background-color: #fff; color: #1f2937; border: 1px solid #d1d5db;" onchange="showSelectedPersonTree()">
                <option value="">-- Ch·ªçn ng∆∞·ªùi --</option>
            </select>
            
            <!-- N√∫t hi·ªÉn th·ªã c√¢y -->
            <button class="btn-control" onclick="showSelectedPersonTree()">
                <i class="fas fa-sitemap"></i> Hi·ªÉn th·ªã C√¢y
            </button>
              <!-- üÜï N√öT XEM TO√ÄN B·ªò -->
    <button class="btn-control" onclick="showFullFamilyTree()" 
            style="background: linear-gradient(135deg, #10b981, #34d399); font-weight: 600;">
        <i class="fas fa-project-diagram"></i> Xem to√†n b·ªô C√¢y
    </button>
            <!-- C√°c n√∫t c≈© gi·ªØ nguy√™n -->
            <button class="btn-control" onclick="resetZoom()">
                <i class="fas fa-redo"></i> ƒê·∫∑t l·∫°i
            </button>
            <button class="btn-control" onclick="downloadTree()">
                <i class="fas fa-download"></i> T·∫£i xu·ªëng
            </button>
        </div>
        
        <!-- SVG Canvas -->
        <svg id="familyTreeSvg" style="width: 100%; height: auto; min-height: 600px; border: 2px solid #fed7aa; border-radius: 16px; background: linear-gradient(135deg, #fffbf0, #fef3c7, #fff7ed);"></svg>
    </div>
</div>

        <!-- MEMBERS TAB -->
        <div id="members" class="tab-content">
            <div class="tree-section">
                <!-- N·ªôi dung danh s√°ch th√†nh vi√™n -->
                <div class="members-grid" id="membersGrid"></div>
            </div>
        </div>
   <!-- ==========================================
             POSTS TAB - B√ÄI VI·∫æT
             ========================================== -->
        <div id="posts" class="tab-content">
            <div class="tree-section">
                <h2 style="font-size: 20px; margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-newspaper" style="color: var(--primary);"></i>
                    B√†i Vi·∫øt & Th√¥ng B√°o
                </h2>

                <!-- Danh s√°ch b√†i vi·∫øt -->
                <div id="postsGrid" style="display: grid; gap: 20px; margin-top: 24px;"></div>

                <!-- Empty state -->
                <div id="postsEmptyState" style="display:none; text-align: center; padding: 60px 20px; color: #999;">
                    <i class="fas fa-newspaper" style="font-size: 64px; color: #e5e7eb; margin-bottom: 16px;"></i>
                    <p style="font-size: 16px; margin-bottom: 8px;">Ch∆∞a c√≥ b√†i vi·∫øt n√†o</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">Chia s·∫ª th√¥ng tin, s·ª± ki·ªán v·ªõi gia ƒë√¨nh</p>
                    <button class="btn-add" onclick="openCreatePostModal()">
                        <i class="fas fa-plus"></i> T·∫°o B√†i vi·∫øt ƒë·∫ßu ti√™n
                    </button>
                </div>
            </div>
        </div>
        <!-- K·∫æT TH√öC POSTS TAB -->
        <!-- SETTINGS TAB -->
<!-- SETTINGS TAB -->
<div id="settings" class="tab-content">
    <div class="tree-section">
        <h2 style="margin-bottom: 24px; font-size: 20px;">‚öôÔ∏è C√†i ƒë·∫∑t & C√¥ng c·ª•</h2>
        
        <!-- Grid ch·ª©a c√°c card -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px;">
            
            <!-- Card 1: Xu·∫•t PDF -->
            <div class="settings-card" onclick="exportPDF()">
                <i class="fas fa-file-pdf" style="font-size: 48px; color: #ef4444;"></i>
                <h3>üì• Xu·∫•t PDF</h3>
                <p>Xu·∫•t to√†n b·ªô gia ph·∫£ th√†nh file PDF</p>
                <small style="color: #999;">Bao g·ªìm t·∫•t c·∫£ th√†nh vi√™n v√† th·ªëng k√™</small>
            </div>

            <!-- Card 2: Import CSV -->
            <div class="settings-card" onclick="importData()">
                <i class="fas fa-file-upload" style="font-size: 48px; color: #10b981;"></i>
                <h3>üì§ Nh·∫≠p D·ªØ Li·ªáu</h3>
                <p>Import th√†nh vi√™n t·ª´ file CSV</p>
                <button onclick="event.stopPropagation(); downloadSampleCSV()" 
                        style="margin-top: 8px; padding: 6px 12px; background: #e5e7eb; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    ‚¨áÔ∏è T·∫£i file m·∫´u
                </button>
            </div>

            <!-- Card 3: Reset d·ªØ li·ªáu -->
            <div class="settings-card" onclick="resetData()" style="border-left-color: #ef4444;">
                <i class="fas fa-redo" style="font-size: 48px; color: #f97316;"></i>
                <h3>üîÑ Kh√¥i Ph·ª•c M·∫´u</h3>
                <p>X√≥a to√†n b·ªô v√† load l·∫°i d·ªØ li·ªáu m·∫´u</p>
                <small style="color: #ef4444; font-weight: 600;">‚ö†Ô∏è H√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c!</small>
            </div>
            <!-- Card 3: X√≥a to√†n b·ªô th√†nh vi√™n -->
<div class="settings-card" id="deleteAllMembersCard" onclick="deleteAllMembers()" style="display:none; border-left-color: #dc2626;">
    <i class="fas fa-user-slash" style="font-size: 48px; color: #dc2626;"></i>
    <h3>üóëÔ∏è X√≥a To√†n B·ªô Th√†nh Vi√™n</h3>
    <p>X√≥a T·∫§T C·∫¢ th√†nh vi√™n kh·ªèi gia ph·∫£</p>
    <small style="color: #dc2626; font-weight: 600;">‚ö†Ô∏è Ch·ªâ Admin, kh√¥ng th·ªÉ ho√†n t√°c!</small>
</div>
<div class="settings-card" id="clearLogsCard" onclick="clearAllActivityLogs()" style="display:none; border-left-color: #ef4444;">
    <i class="fas fa-trash-alt" style="font-size: 48px; color: #ef4444;"></i>
    <h3>üóëÔ∏è X√≥a L·ªãch S·ª≠</h3>
    <p>X√≥a to√†n b·ªô l·ªãch s·ª≠ ho·∫°t ƒë·ªông</p>
    <small style="color: #ef4444; font-weight: 600;">‚ö†Ô∏è Ch·ªâ Admin, kh√¥ng th·ªÉ ho√†n t√°c!</small>
</div>
            <!-- Card 4: Th√¥ng tin h·ªá th·ªëng -->
            <div class="settings-card" style="cursor: default; opacity: 0.8;">
                <i class="fas fa-info-circle" style="font-size: 48px; color: #3b82f6;"></i>
                <h3>‚ÑπÔ∏è Th√¥ng Tin</h3>
                <p style="font-size: 13px; color: #666;">
                    Version: 1.0.0<br>
                    Database: SQLite<br>
                    Owner ID: <span id="ownerIdDisplay">-</span>
                </p>
            </div>
            <!-- Card 5: Qu·∫£n l√Ω Viewer (CH·ªà HI·ªÜN V·ªöI ADMIN) -->
<div class="settings-card" id="viewerManagementCard" onclick="openViewerManagement()" style="display:none;">
    <i class="fas fa-users-cog" style="font-size: 48px; color: #8b5cf6;"></i>
    <h3>üë• Qu·∫£n L√Ω Viewer</h3>
    <p>T·∫°o v√† qu·∫£n l√Ω t√†i kho·∫£n xem gia ph·∫£</p>
    <small style="color: #999;">C·∫•p quy·ªÅn xem cho ng∆∞·ªùi kh√°c</small>
</div>
        </div>
        <!-- K·∫øt th√∫c grid -->

     <!-- Thay th·∫ø ph·∫ßn h∆∞·ªõng d·∫´n c≈© b·∫±ng ƒëo·∫°n n√†y -->
<div style="margin-top: 40px; padding: 24px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-left: 4px solid #0ea5e9; border-radius: 12px;">
    <h3 style="margin-bottom: 16px; color: #0369a1; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-file-csv"></i> üìã H∆∞·ªõng D·∫´n Import CSV ƒê·∫ßy ƒê·ªß
    </h3>
    
    <!-- C·∫•u tr√∫c file -->
    <div style="margin-bottom: 20px;">
        <h4 style="color: #0284c7; margin-bottom: 8px;">üìå C√°c c·ªôt B·∫ÆT BU·ªòC:</h4>
        <ul style="color: #374151; line-height: 1.8; margin-left: 20px;">
            <li><code style="background: #fff; padding: 2px 6px; border-radius: 4px; color: #dc2626;">full_name</code> - H·ªç v√† t√™n ƒë·∫ßy ƒë·ªß</li>
            <li><code style="background: #fff; padding: 2px 6px; border-radius: 4px; color: #dc2626;">gender</code> - Gi·ªõi t√≠nh: <strong>"Nam"</strong> ho·∫∑c <strong>"N·ªØ"</strong></li>
           
        </ul>
    </div>

    <div style="margin-bottom: 20px;">
        <h4 style="color: #0284c7; margin-bottom: 8px;">üîß C√°c c·ªôt T√ôY CH·ªåN:</h4>
        <ul style="color: #374151; line-height: 1.8; margin-left: 20px;">
            <li><code>birth_date</code> - Ng√†y sinh (YYYY-MM-DD) 
        <strong style="color: #f97316;">ho·∫∑c "unknown" n·∫øu kh√¥ng r√µ</strong>
    </li>
    <li><code>death_date</code> - Ng√†y m·∫•t (YYYY-MM-DD) 
        <strong style="color: #f97316;">ho·∫∑c "unknown" n·∫øu kh√¥ng r√µ</strong>
    </li>
            <li><code>generation</code> - Th·∫ø h·ªá (1, 2, 3...)</li>
            <li><code>notes</code> - Ghi ch√∫</li>
            <li><code>phone</code> - S·ªë ƒëi·ªán tho·∫°i</li>
            <li><code>job</code> - Ngh·ªÅ nghi·ªáp</li>
            <li><code>address</code> - ƒê·ªãa ch·ªâ</li>
            <li><code style="background: #fef3c7; padding: 2px 6px; border-radius: 4px; color: #f97316;">parent_name</code> - ‚≠ê H·ªç t√™n cha/m·∫π (ƒë·ªÉ tr·ªëng n·∫øu th·ªßy t·ªï)</li>
            <li><code style="background: #fef3c7; padding: 2px 6px; border-radius: 4px; color: #f97316;">spouse_name</code> - ‚≠ê H·ªç t√™n v·ª£/ch·ªìng (ƒë·ªÉ tr·ªëng n·∫øu ch∆∞a c√≥)</li>
        </ul>
    </div>
    
    <!-- L∆∞u √Ω quan tr·ªçng -->
   <div style="margin-top: 20px; padding: 16px; background: #fff7ed; border-radius: 8px; border: 2px solid #fed7aa;">
    <p style="color: #c2410c; font-weight: 700; margin-bottom: 12px; font-size: 16px;">
        ‚ö†Ô∏è L∆ØU √ù QUAN TR·ªåNG V·ªÄ TH·∫æ H·ªÜ:
    </p>
    <ul style="color: #9a3412; font-size: 14px; margin-left: 20px; line-height: 1.8;">
        <li><strong>‚úÖ Th·∫ø h·ªá ƒë∆∞·ª£c T·ª∞ ƒê·ªòNG T√çNH:</strong>
            <ul style="margin-left: 20px; margin-top: 4px;">
                <li>N·∫øu c√≥ <code>parent_name</code> ‚Üí Th·∫ø h·ªá = Th·∫ø h·ªá cha/m·∫π + 1</li>
                <li>N·∫øu ch·ªâ c√≥ <code>spouse_name</code> ‚Üí Th·∫ø h·ªá = Th·∫ø h·ªá v·ª£/ch·ªìng</li>
                <li>Th·ªßy t·ªï (ƒë·ªùi 1) ‚Üí ƒê·ªÉ <code>generation=1</code> v√† <code>parent_name</code> tr·ªëng</li>
            </ul>
        </li>
        <li><strong>‚ö†Ô∏è Quy t·∫Øc b·∫Øt bu·ªôc:</strong>
            <ul style="margin-left: 20px; margin-top: 4px;">
                <li>Th·ªßy t·ªï: <code>generation=1</code>, KH√îNG ƒë∆∞·ª£c c√≥ <code>parent_name</code></li>
                <li>ƒê·ªùi > 1: Ph·∫£i c√≥ <code>parent_name</code> HO·∫∂C <code>spouse_name</code></li>
                <li>T√™n trong <code>parent_name</code> v√† <code>spouse_name</code> ph·∫£i kh·ªõp CH√çNH X√ÅC</li>
            </ul>
        </li>
        <li><strong>üìå Th·ª© t·ª± import:</strong> Ph·∫£i import cha/m·∫π TR∆Ø·ªöC, con SAU</li>
    </ul>
</div>

    <!-- V√≠ d·ª• th·ª±c t·∫ø -->
    <div style="margin-top: 20px; padding: 16px; background: #f3f4f6; border-radius: 8px; border-left: 4px solid #6b7280;">
        <p style="color: #374151; font-weight: 600; margin-bottom: 8px;">üìù V√ç D·ª§ D√íNG CSV:</p>
        <pre style="background: #fff; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 12px; color: #1f2937;">Nguy·ªÖn VƒÉn A,Nam,1880-01-15,1945-08-20,1,Th·ªßy t·ªï,,N√¥ng d√¢n,H√† N·ªôi,,Tr·∫ßn Th·ªã B
Tr·∫ßn Th·ªã B,N·ªØ,1885-03-10,1952-06-12,1,V·ª£ c·ª• A,,D·ªát v·∫£i,H√† N·ªôi,,Nguy·ªÖn VƒÉn A
Nguy·ªÖn VƒÉn C,Nam,1930-01-25,,2,Con tr∆∞·ªüng,,K·ªπ s∆∞,H√† N·ªôi,Nguy·ªÖn VƒÉn A,L√™ Th·ªã D</pre>
    </div>
    
    <p style="margin-top: 16px; color: #6b7280; font-style: italic; font-size: 14px;">
        üí° <strong>Tip:</strong> Click n√∫t <strong>"T·∫£i file m·∫´u"</strong> ƒë·ªÉ c√≥ file CSV ho√†n ch·ªânh v·ªõi d·ªØ li·ªáu m·∫´u.
    </p>
</div>
        <!-- K·∫øt th√∫c h∆∞·ªõng d·∫´n -->

    </div>
</div>
<!-- K·∫øt th√∫c SETTINGS TAB -->
    <!-- MEMBER DETAIL MODAL -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Th√¥ng Tin Th√†nh Vi√™n</h2>
                <button class="close-btn" onclick="closeMemberModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="memberDetailContent"></div>
        </div>
    </div>

    <!-- ADD/EDIT MEMBER MODAL -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addModalTitle">Th√™m Th√†nh Vi√™n</h2>
                <button class="close-btn" onclick="closeAddMemberModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="memberForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>H·ªç v√† T√™n *</label>
                            <input type="text" id="memberName" required>
                        </div>
                        <div class="form-group">
                            <label>Gi·ªõi T√≠nh</label>
                            <select id="memberGender">
                                <option value="male">Nam</option>
                                <option value="female">N·ªØ</option>
                            </select>
                        </div>
                    </div>

                   <div class="form-row">
    <div class="form-group">
        <label>Ng√†y Sinh</label>
        <input type="date" id="memberBirth" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng r√µ">
        <small style="color: #6b7280; font-size: 11px; display: block; margin-top: 4px;">
            üí° C√≥ th·ªÉ ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng bi·∫øt ch√≠nh x√°c
        </small>
    </div>
    <div class="form-group">
        <label>Ng√†y M·∫•t</label>
        <input type="date" id="memberDeath" placeholder="ƒê·ªÉ tr·ªëng n·∫øu c√≤n s·ªëng ho·∫∑c kh√¥ng r√µ">
        <div style="margin-top: 8px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                <input type="checkbox" id="isDeceasedUnknown" style="width: auto;">
                <span style="font-size: 13px;">‚òëÔ∏è ƒê√£ m·∫•t nh∆∞ng kh√¥ng r√µ ng√†y</span>
            </label>
        </div>
    </div>
</div>

                    <div class="form-row">
    <div class="form-group">
        <label>S·ªë ƒêi·ªán Tho·∫°i</label>
        <input type="tel" id="memberPhone" placeholder="0912345678">
    </div>
    <div class="form-group">
        <label>
            Th·∫ø H·ªá 
            <span style="color: #f97316; font-size: 11px;">(T·ª± ƒë·ªông t√≠nh)</span>
        </label>
        <select id="memberGeneration" disabled>
            <option value="1">Th·∫ø h·ªá 1 (Th·ªßy t·ªï)</option>
        </select>
    </div>
</div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ngh·ªÅ Nghi·ªáp</label>
                            <input type="text" id="memberJob" placeholder="V√≠ d·ª•: N√¥ng d√¢n">
                        </div>
                        <div class="form-group">
                            <label>ƒê·ªãa Ch·ªâ</label>
                            <input type="text" id="memberAddress" placeholder="V√≠ d·ª•: Qu·∫£ng Tr·ªã">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ghi Ch√∫ / M·ªëi Quan H·ªá</label>
                        <textarea id="memberNote" placeholder="V√≠ d·ª•: √îng ngo√†i, B√†, v.v."></textarea>
                    </div>

                  <div class="form-row">
    <div class="form-group">
        <label>
            Cha/M·∫π 
            <span style="color: #f97316; font-size: 11px;">(B·∫Øt bu·ªôc n·∫øu ƒë·ªùi > 1)</span>
        </label>
        <select id="memberParent">
            <option value="">-- Kh√¥ng c√≥ (Ch·ªâ d√†nh cho th·ªßy t·ªï) --</option>
        </select>
    </div>
    <div class="form-group">
        <label>V·ª£/Ch·ªìng</label>
        <select id="memberSpouse">
            <option value="">-- Kh√¥ng c√≥ --</option>
        </select>
    </div>
</div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeAddMemberModal()">H·ªßy</button>
                        <button type="submit" class="btn-save">L∆∞u Th√†nh Vi√™n</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ADVANCED SEARCH MODAL -->
    <div id="advancedSearchModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üîç T√¨m Ki·∫øm N√¢ng Cao</h2>
                <button class="close-btn" onclick="closeAdvancedSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="advancedSearchForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="form-group">
                        <label>H·ªç v√† T√™n</label>
                        <input type="text" id="searchName" placeholder="Nh·∫≠p t√™n th√†nh vi√™n...">
                    </div>

                    <div class="form-row">
                       <div class="form-group">
    <label>Th·∫ø H·ªá</label>
    <select id="searchGeneration">
        <option value="">-- T·∫•t c·∫£ --</option>
        <!-- C√°c option s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông b·∫±ng JavaScript -->
    </select>
</div>
                        <div class="form-group">
                            <label>Gi·ªõi T√≠nh</label>
                            <select id="searchGender">
                                <option value="all">-- T·∫•t c·∫£ --</option>
                                <option value="male">Nam</option>
                                <option value="female">N·ªØ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Tr·∫°ng Th√°i</label>
                            <select id="searchStatus">
                                <option value="">-- T·∫•t c·∫£ --</option>
                                <option value="living">ƒêang s·ªëng</option>
                                <option value="deceased">Qu√° c·ªë</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ngh·ªÅ Nghi·ªáp</label>
                            <input type="text" id="searchJob" placeholder="V√≠ d·ª•: Gi√°o vi√™n">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Tu·ªïi t·ª´</label>
                            <input type="number" id="searchAgeMin" placeholder="Tu·ªïi t·ªëi thi·ªÉu" min="0" max="150">
                        </div>
                        <div class="form-group">
                            <label>Tu·ªïi ƒë·∫øn</label>
                            <input type="number" id="searchAgeMax" placeholder="Tu·ªïi t·ªëi ƒëa" min="0" max="150">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ƒê·ªãa Ch·ªâ</label>
                        <input type="text" id="searchAddress" placeholder="V√≠ d·ª•: H√† N·ªôi">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="resetAdvancedSearch()">ƒê·∫∑t L·∫°i</button>
                        <button type="button" class="btn-save" onclick="performAdvancedSearch()">T√¨m Ki·∫øm</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<!-- ==========================================
     VIEWER MANAGEMENT MODAL
     ========================================== -->
<div id="viewerModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>üë• Qu·∫£n L√Ω Viewer</h2>
            <button class="close-btn" onclick="closeViewerModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- N√∫t t·∫°o viewer m·ªõi -->
            <div style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn-add" onclick="openCreateViewerForm()">
                    <i class="fas fa-plus"></i> T·∫°o Viewer M·ªõi
                </button>
                <p style="color: #666; font-size: 13px; margin: 0;">
                    <i class="fas fa-info-circle"></i> Viewer ch·ªâ xem ƒë∆∞·ª£c, kh√¥ng th·ªÉ s·ª≠a/x√≥a
                </p>
            </div>

            <!-- Form t·∫°o viewer (·∫©n m·∫∑c ƒë·ªãnh) -->
            <!-- Form t·∫°o viewer (·∫©n m·∫∑c ƒë·ªãnh) -->
<div id="createViewerForm" style="display:none; margin-bottom: 24px; padding: 24px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; border-left: 4px solid #0ea5e9;">
    <h3 style="margin-bottom: 16px; color: #0369a1;">
        <i class="fas fa-user-plus"></i> T·∫°o Viewer M·ªõi
    </h3>
    <div class="form-group">
        <label>H·ªç v√† T√™n <span style="color: #ef4444;">*</span></label>
        <input type="text" id="newViewerName" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" required style="font-size: 15px;">
    </div>
    <div class="form-group">
        <label>M·∫≠t Kh·∫©u <span style="color: #ef4444;">*</span></label>
        <input type="password" id="newViewerPassword" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" required style="font-size: 15px;">
        <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
            <i class="fas fa-info-circle"></i> M·∫≠t kh·∫©u ƒë·ªÉ viewer ƒëƒÉng nh·∫≠p (t·ªëi thi·ªÉu 6 k√Ω t·ª±)
        </small>
    </div>
    <div class="form-actions" style="margin-top: 16px;">
        <button class="btn-cancel" onclick="cancelCreateViewer()">
            <i class="fas fa-times"></i> H·ªßy
        </button>
        <button class="btn-save" onclick="submitCreateViewer()">
            <i class="fas fa-check"></i> T·∫°o Viewer
        </button>
    </div>
</div>

            <!-- Danh s√°ch viewer -->
            <div id="viewerList" style="display: grid; gap: 16px;"></div>

            <!-- Empty state -->
            <div id="viewerEmptyState" style="display:none; text-align: center; padding: 60px 20px; color: #999;">
                <i class="fas fa-users" style="font-size: 64px; color: #e5e7eb; margin-bottom: 16px;"></i>
                <p style="font-size: 16px; margin-bottom: 8px;">Ch∆∞a c√≥ viewer n√†o</p>
                <p style="font-size: 14px;">Click "T·∫°o Viewer M·ªõi" ƒë·ªÉ c·∫•p quy·ªÅn xem cho ng∆∞·ªùi kh√°c</p>
            </div>
        </div>
    </div>
</div>
<!-- ==========================================
     CREATE/EDIT POST MODAL
     ========================================== -->
<div id="postModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 id="postModalTitle">‚úçÔ∏è T·∫°o B√†i Vi·∫øt</h2>
            <button class="close-btn" onclick="closePostModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="postForm">
                <!-- Ti√™u ƒë·ªÅ -->
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="postTitle" required placeholder="V√≠ d·ª•: Th√¥ng b√°o h·ªçp m·∫∑t gia ƒë√¨nh">
                </div>

                <!-- Danh m·ª•c v√† Ghim -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Danh m·ª•c</label>
                        <select id="postCategory">
                            <option value="announcement">üì¢ Th√¥ng b√°o</option>
                            <option value="event">üéâ S·ª± ki·ªán</option>
                            <option value="news">üì∞ Tin t·ª©c</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="postPinned" style="width: auto;">
                            üìå Ghim b√†i vi·∫øt l√™n ƒë·∫ßu
                        </label>
                    </div>
                </div>

                <!-- N·ªôi dung -->
                <div class="form-group">
                    <label>N·ªôi dung <span style="color: #ef4444;">*</span></label>
                    <textarea id="postContent" required placeholder="Nh·∫≠p n·ªôi dung b√†i vi·∫øt..." style="min-height: 250px;"></textarea>
                    <small style="color: #6b7280; font-size: 12px; display: block; margin-top: 4px;">
                        <i class="fas fa-info-circle"></i> H·ªó tr·ª£ xu·ªëng d√≤ng v√† k√Ω t·ª± ƒë·∫∑c bi·ªát
                    </small>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closePostModal()">
                        <i class="fas fa-times"></i> H·ªßy
                    </button>
                    <button type="submit" class="btn-save">
                        <i class="fas fa-check"></i> L∆∞u B√†i Vi·∫øt
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ==========================================
     VIEW POST MODAL
     ========================================== -->
<div id="viewPostModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2 id="viewPostTitle"></h2>
            <button class="close-btn" onclick="closeViewPostModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Metadata -->
            <div id="viewPostMeta" style="display: flex; gap: 16px; padding: 12px 0; border-bottom: 2px solid #e5e7eb; margin-bottom: 20px; font-size: 13px; color: #6b7280;"></div>
            
            <!-- Content -->
            <div id="viewPostContent" style="line-height: 1.8; white-space: pre-wrap;"></div>

            <!-- Actions -->
            <div id="viewPostActions" style="display: flex; gap: 12px; margin-top: 24px; padding-top: 20px; border-top: 2px solid #e5e7eb;"></div>
        </div>
    </div>
</div>
   <!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="../components/familyTreeRenderer.js"></script>
<script src="../components/dashboard.js"></script>
</body>
</html>